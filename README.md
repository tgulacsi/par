# PAR
Create parity file like PAR2, and restore the file even if parts are damaged.

The parity file is a simple TAR file, the Reed-Solomon code is from github.com/klauspost/reedsolomon, the speed is from there.

## Known bugs
The format is not PAR2-compatible - I've tried, but failed. If anyone can help, I'll be glad!

## Speed
`par2` with 30% redundancy for a 20MiB `initrd.img` is 10s,
`par` is just 43ms.

### par2
```
$ l -L /tmp/initrd.img-4.8.0-2-amd64
-rw-r--r-- 1 root root 20130174 dec   24 15:43 /tmp/initrd.img-4.8.0-2-amd64

$ time par2create -r30 /tmp/y /tmp/initrd.img-4.8.0-2-amd64
Block size: 10068
Source file count: 1
Source block count: 2000
Redundancy: 30%
Recovery block count: 600
Recovery file count: 10

Opening: initrd.img-4.8.0-2-amd64
Computing Reed Solomon matrix.
Constructing: done.
Wrote 6040800 bytes to disk
Writing recovery packets
Writing verification packets
Done

real    0m10,713s
```

### par
```
$ time par c -r 30 /tmp/initrd.img-4.8.0-2-amd64 /tmp/x
2016/12/26 19:14:54 Create "/tmp/x" for "/tmp/initrd.img-4.8.0-2-amd64".

real    0m0,043s
```

The created file is just a plain old tar archive. The file names contains the required data (position, size, hash). The files for the data shards are empty, only the parity shards contains data:

```
$ tar tvaf /tmp/x
-r--r--r-- 1000/1000        74 2016-12-26 19:14 FileMetadata.json
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":1,"s":524288,"h":699273436}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":2,"s":524288,"h":2898454369}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":3,"s":524288,"h":2292562115}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":4,"s":524288,"h":3692255674}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":5,"s":524288,"h":1632793342}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":6,"s":524288,"h":825591678}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":7,"s":524288,"h":3770807159}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":8,"s":524288,"h":752060309}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":9,"s":524288,"h":2746344130}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":10,"s":524288,"h":212905395}.dat
-r--r--r-- 1000/1000    524288 2016-12-26 19:14 shard-{"i":11,"s":524288,"h":1529392889}.dat
-r--r--r-- 1000/1000    524288 2016-12-26 19:14 shard-{"i":12,"s":524288,"h":1911809652}.dat
-r--r--r-- 1000/1000    524288 2016-12-26 19:14 shard-{"i":13,"s":524288,"h":1559672903}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":14,"s":524288,"h":2787855315}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":15,"s":524288,"h":330156776}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":16,"s":524288,"h":3305512117}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":17,"s":524288,"h":1392759651}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":18,"s":524288,"h":2914320745}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":19,"s":524288,"h":361803619}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":20,"s":524288,"h":2686068855}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":21,"s":524288,"h":3011200362}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":22,"s":524288,"h":164489674}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":23,"s":524288,"h":4110660250}.dat
-r--r--r-- 1000/1000    524288 2016-12-26 19:14 shard-{"i":24,"s":524288,"h":3242328003}.dat
-r--r--r-- 1000/1000    524288 2016-12-26 19:14 shard-{"i":25,"s":524288,"h":2453827528}.dat
-r--r--r-- 1000/1000    524288 2016-12-26 19:14 shard-{"i":26,"s":524288,"h":543191556}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":27,"s":524288,"h":1884612159}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":28,"s":524288,"h":2663060901}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":29,"s":524288,"h":194395813}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":30,"s":524288,"h":3052894666}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":31,"s":524288,"h":2914073251}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":32,"s":524288,"h":3850203840}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":33,"s":524288,"h":3523310352}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":34,"s":524288,"h":2757281388}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":35,"s":524288,"h":3842225358}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":36,"s":524288,"h":4280052356}.dat
-r--r--r-- 1000/1000    524288 2016-12-26 19:14 shard-{"i":37,"s":524288,"h":462408700}.dat
-r--r--r-- 1000/1000    524288 2016-12-26 19:14 shard-{"i":38,"s":524288,"h":2846018817}.dat
-r--r--r-- 1000/1000    524288 2016-12-26 19:14 shard-{"i":39,"s":524288,"h":983386159}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":40,"s":524288,"h":1447901203}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":41,"s":524288,"h":3896563328}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":42,"s":524288,"h":2218122961}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":43,"s":524288,"h":1909087728}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":44,"s":524288,"h":1731875316}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":45,"s":524288,"h":3098368541}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":46,"s":524288,"h":2552201363}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":47,"s":524288,"h":1325880353}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":48,"s":207230,"h":3338007026}.dat
-r--r--r-- 1000/1000         0 2016-12-26 19:14 shard-{"i":49,"s":0,"h":0}.dat
-r--r--r-- 1000/1000    524288 2016-12-26 19:14 shard-{"i":50,"s":524288,"h":1796069680}.dat
-r--r--r-- 1000/1000    524288 2016-12-26 19:14 shard-{"i":51,"s":524288,"h":2876482950}.dat
-r--r--r-- 1000/1000    524288 2016-12-26 19:14 shard-{"i":52,"s":524288,"h":2349474476}.dat

```
